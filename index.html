<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>UNO com Bots</title>
<style>
  body { font-family: 'Segoe UI', Arial, sans-serif; background: #2c3e50; color: #ecf0f1; text-align: center; margin: 0; padding: 0; }
  h1 { margin-top: 25px; font-weight: 300; }
  #mesa {
    margin: 30px auto; padding: 20px; border: 4px solid #fff; max-width: 300px;
    font-size: 1.4em; border-radius: 15px; background: #34495e;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
    position: relative;
    height: 150px;
  }
  #cartaMesa {
    margin-top: 15px; padding: 30px; border-radius: 18px;
    font-weight: bold; font-size: 1.6em; user-select: none;
    box-shadow: 0 0 20px 5px rgba(255,255,255,0.7);
    transition: all 0.5s ease;
  }
  #mao {
    margin: 25px auto; display: flex; justify-content: center; flex-wrap: wrap; gap: 15px; max-width: 950px;
    position: relative;
  }
  .carta {
    padding: 25px 32px; border-radius: 18px; cursor: pointer;
    user-select: none; font-weight: bold; font-size: 1.4em;
    color: white;
    box-shadow: 0 5px 10px rgba(0,0,0,0.8);
    transition: transform 0.2s, box-shadow 0.2s;
    min-width: 75px; text-align: center;
    position: relative;
    user-select:none;
  }
  .carta:hover {
    transform: translateY(-8px) scale(1.1);
    box-shadow: 0 8px 18px rgba(255,255,255,0.8);
  }
  .Vermelho { background-color: #c0392b; }
  .Verde { background-color: #27ae60; }
  .Azul { background-color: #2980b9; }
  .Amarelo { background-color: #f39c12; color: black; }
  .Coringa {
    background: linear-gradient(45deg, #2c3e50, #555);
    color: white;
  }
  .card-in-flight {
      position: absolute;
      transition: all 0.5s ease-in-out;
      z-index: 100;
  }
  button {
    margin: 10px 15px; padding: 14px 35px; font-size: 1.2em;
    cursor: pointer; border-radius: 10px; border: none; background: #3498db; color: white;
    transition: background-color 0.3s, transform 0.2s;
    box-shadow: 0 4px 6px rgba(0,0,0,0.5);
  }
  button:hover {
    background: #2980b9;
    transform: translateY(-2px);
  }
  #info {
    margin-top: 20px; font-size: 1.2em; min-height: 40px;
  }
  #config {
    margin: 30px auto; max-width: 400px; background: #34495e; padding: 25px;
    border-radius: 15px; border: 2px solid #446;
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
  }
  label {
    display: block; margin: 12px 0 8px 0; font-weight: bold; font-size: 1.2em;
  }
  select, input[type=number] {
    width: 70px; padding: 8px; font-size: 1.1em; border-radius: 8px; border: 1px solid #777;
    background: #2c3e50; color: white; text-align: center;
  }
  #mao-bots {
    margin: 20px auto; display: flex; justify-content: center; gap: 10px;
  }
  .mao-bot {
    width: 60px; height: 80px; background: #7f8c8d; border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.1em;
    border: 2px solid #bdc3c7;
    flex-direction: column;
  }
</style>
</head>
<body>

<h1>UNO com Bots</h1>

<div id="config">
  <label for="numHumanos">Número de jogadores humanos:</label>
  <select id="numHumanos">
    <option value="1" selected>1</option>
    <option value="2">2</option>
  </select>

  <label for="numBots">Número de bots:</label>
  <select id="numBots">
    <option value="1">1</option>
    <option value="2" selected>2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
  </select>

  <button id="startBtn">Começar Jogo</button>
  <div style="margin-top:10px; font-size: 0.9em; color: #aaa;">
    * Total de jogadores deve ser entre 2 e 8.
  </div>
</div>

<div id="mesa" style="display:none;">
  <div id="turno"></div>
  <div><strong>Carta na mesa:</strong></div>
  <div id="cartaMesa"></div>
  <div id="info"></div>
</div>

<div id="mao-bots"></div>

<div id="mao"></div>

<button id="comprarBtn" style="display:none;">Comprar Carta</button>
<button id="unoBtn" style="display:none;">UNO!</button>
<button id="pegarUnoBtn" style="display:none;">Pegar UNO!</button>

<script>
(() => {
  const cores = ['Vermelho', 'Verde', 'Azul', 'Amarelo'];
  const acoes = ['Pular', 'Inverter', '+2'];
  const coringas = ['Coringa', '+4'];

  let baralho = [];
  let maos = [];
  let mesa = null;
  let jogadorAtual = 0;
  let direcao = 1;
  let numJogadores = 4;
  let humanos = 1;
  let bots = 3;
  let punicao = 0;
  let unoAnunciado = false;
  let jogoEmAndamento = false;

  const cartaMesaDiv = document.getElementById('cartaMesa');
  const maoDiv = document.getElementById('mao');
  const turnoDiv = document.getElementById('turno');
  const infoDiv = document.getElementById('info');
  const comprarBtn = document.getElementById('comprarBtn');
  const unoBtn = document.getElementById('unoBtn');
  const pegarUnoBtn = document.getElementById('pegarUnoBtn');
  const startBtn = document.getElementById('startBtn');
  const numHumanosSelect = document.getElementById('numHumanos');
  const numBotsSelect = document.getElementById('numBots');
  const mesaDiv = document.getElementById('mesa');
  const configDiv = document.getElementById('config');
  const maoBotsDiv = document.getElementById('mao-bots');

  function criarBaralho() {
    let baralho = [];
    for (const cor of cores) {
      baralho.push({cor, valor: 0});
      for (let n = 1; n <= 9; n++) {
        baralho.push({cor, valor: n});
        baralho.push({cor, valor: n});
      }
      for (const acao of acoes) {
        baralho.push({cor, valor: acao});
        baralho.push({cor, valor: acao});
      }
    }
    for (let i = 0; i < 4; i++) {
      baralho.push({cor: 'Coringa', valor: 'Coringa'});
      baralho.push({cor: 'Coringa', valor: '+4'});
    }
    return baralho.sort(() => Math.random() - 0.5);
  }

  function mostrarCarta(carta) {
    if (!carta) return '';
    return carta.valor + (carta.cor !== 'Coringa' ? ' de ' + carta.cor : '');
  }

  function podeJogar(carta, mesa) {
    if (!mesa) return true;
    if (punicao > 0) {
        return (carta.valor === '+2' || carta.valor === '+4');
    }
    return (
      carta.cor === mesa.cor ||
      carta.valor === mesa.valor ||
      carta.cor === 'Coringa'
    );
  }

  function atualizarMesa() {
    if (!mesa) return;
    cartaMesaDiv.textContent = mostrarCarta(mesa);
    cartaMesaDiv.className = mesa.cor;
    if (punicao > 0) {
        infoDiv.textContent = `Punição acumulada: +${punicao} cartas!`;
    } else {
        infoDiv.textContent = '';
    }
  }

  function atualizarMao() {
    maoDiv.innerHTML = '';
    const mao = maos[jogadorAtual];
    const jogadorEhHumano = jogadorAtual < humanos;
    mao.forEach((carta, idx) => {
      const div = document.createElement('div');
      div.className = 'carta ' + carta.cor;
      div.textContent = carta.valor;
      div.title = mostrarCarta(carta);
      if (jogadorEhHumano && podeJogar(carta, mesa)) {
        div.onclick = () => jogarCarta(idx, div);
      } else {
        div.style.opacity = '0.5';
      }
      maoDiv.appendChild(div);
    });

    comprarBtn.style.display = (jogadorEhHumano && !punicao > 0) ? 'inline-block' : 'none';
    unoBtn.style.display = (jogadorEhHumano && mao.length === 2 && !unoAnunciado) ? 'inline-block' : 'none';
    pegarUnoBtn.style.display = (jogadorAtual >= humanos || maos[jogadorAtual].length > 2) ? 'none' : 'inline-block';

    maoBotsDiv.innerHTML = '';
    for (let i = humanos; i < numJogadores; i++) {
        const div = document.createElement('div');
        div.className = 'mao-bot';
        div.innerHTML = `<span style="font-size: 2em; font-weight: bold;">${maos[i].length}</span><br><span>Bot ${i + 1}</span>`;
        maoBotsDiv.appendChild(div);
    }
  }

  function atualizarTurno() {
    const tipoJogador = jogadorAtual < humanos ? 'Humano' : 'Bot';
    turnoDiv.textContent = `Turno do Jogador ${jogadorAtual + 1} (${tipoJogador})`;
  }

  function proximoJogador() {
    jogadorAtual = (jogadorAtual + direcao + numJogadores) % numJogadores;
  }

  async function escolherCorHumano() {
      return new Promise(resolve => {
          infoDiv.innerHTML = 'Escolha uma cor: ';
          cores.forEach((cor) => {
              const btn = document.createElement('button');
              btn.textContent = cor;
              btn.style.backgroundColor = getCorCSS(cor);
              btn.style.color = (cor === 'Amarelo') ? 'black' : 'white';
              btn.style.margin = '0 5px';
              btn.onclick = () => {
                  infoDiv.textContent = '';
                  resolve(cor);
              };
              infoDiv.appendChild(btn);
          });
      });
  }

  function getCorCSS(cor) {
    switch(cor) {
        case 'Vermelho': return '#c0392b';
        case 'Verde': return '#27ae60';
        case 'Azul': return '#2980b9';
        case 'Amarelo': return '#f39c12';
        case 'Coringa': return '#555';
        default: return '#ccc';
    }
  }

  async function comprarCartas(num) {
      for (let i = 0; i < num; i++) {
          if (baralho.length === 0) {
              infoDiv.textContent = 'Baralho vazio! Embaralhando as cartas da mesa.';
              await esperar(1000);
              baralho = [mesa];
              mesa = null;
              baralho = baralho.sort(() => Math.random() - 0.5);
          }
          maos[jogadorAtual].push(baralho.pop());
      }
  }

  async function comprarBtnClick() {
      if (!jogoEmAndamento) return;
      jogoEmAndamento = false;

      if (punicao > 0) {
          infoDiv.textContent = `Você comprou ${punicao} cartas e perdeu a vez!`;
          await comprarCartas(punicao);
          punicao = 0;
          atualizarMao();
          await esperar(2000);
          proximoJogador();
          turno();
      } else {
          infoDiv.textContent = `Você comprou 1 carta.`;
          await comprarCartas(1);
          atualizarMao();
          await esperar(1000);
          const cartaComprada = maos[jogadorAtual][maos[jogadorAtual].length - 1];
          if (podeJogar(cartaComprada, mesa)) {
              infoDiv.textContent = `Você pode jogar a carta comprada! Jogue ou clique em "Comprar Carta" para passar a vez.`;
              jogoEmAndamento = true;
          } else {
              proximoJogador();
              turno();
          }
      }
  }

  async function jogarCarta(idx, div) {
    if (!jogoEmAndamento) return;
    jogoEmAndamento = false;

    const mao = maos[jogadorAtual];
    const carta = mao[idx];
    if (!podeJogar(carta, mesa)) {
      infoDiv.textContent = `Essa carta não pode ser jogada!`;
      jogoEmAndamento = true;
      return;
    }

    // Animação da carta
    const rect = div.getBoundingClientRect();
    const mesaRect = mesaDiv.getBoundingClientRect();
    div.style.position = 'fixed';
    div.style.left = `${rect.left}px`;
    div.style.top = `${rect.top}px`;
    div.style.zIndex = '100';
    div.style.transition = 'all 0.5s ease-in-out';
    div.style.transform = `translate(${mesaRect.left - rect.left + mesaRect.width / 2}px, ${mesaRect.top - rect.top + mesaRect.height / 2}px) scale(1.2)`;
    
    await esperar(500);

    mao.splice(idx, 1);
    const mesaAnterior = mesa;
    mesa = carta;
    
    cartaMesaDiv.textContent = mostrarCarta(mesa);
    cartaMesaDiv.className = mesa.cor;

    div.remove();

    if (maos[(jogadorAtual + direcao + numJogadores) % numJogadores].length === 1 && !unoAnunciado) {
      await esperar(500);
      alert('Jogador que jogou antes tinha uma carta, mas não gritou UNO!');
      await comprarCartas(2);
      await esperar(1000);
    }
    
    if (mao.length === 0) {
      alert(`Jogador ${jogadorAtual + 1} venceu!`);
      resetarJogo();
      return;
    }
    
    unoAnunciado = false;
    atualizarMao();
    await aplicarEfeitoCarta(carta, mesaAnterior);
  }

  async function aplicarEfeitoCarta(carta, mesaAnterior) {
    if (carta.valor === '+2') {
        punicao += 2;
        proximoJogador();
        await atualizarTurno();
        turno();
    } else if (carta.valor === '+4') {
        punicao += 4;
        if (jogadorAtual < humanos) {
            const corEscolhida = await escolherCorHumano();
            mesa.cor = corEscolhida;
            atualizarMesa();
        } else {
            const corEscolhida = escolherCorBot(maos[jogadorAtual]);
            mesa.cor = corEscolhida;
            infoDiv.textContent = `Bot escolheu a cor ${corEscolhida}`;
            atualizarMesa();
        }
        proximoJogador();
        await atualizarTurno();
        turno();
    } else if (punicao > 0) {
        infoDiv.textContent = `Jogador ${(jogadorAtual + direcao + numJogadores) % numJogadores + 1} comprou ${punicao} cartas.`;
        await comprarCartas(punicao);
        punicao = 0;
        proximoJogador();
        await atualizarTurno();
        turno();
    } else if (carta.valor === 'Pular') {
      infoDiv.textContent = `Jogador ${(jogadorAtual + direcao + numJogadores) % numJogadores + 1} foi pulado!`;
      proximoJogador();
      proximoJogador();
      await atualizarTurno();
      turno();
    } else if (carta.valor === 'Inverter') {
      direcao *= -1;
      infoDiv.textContent = 'Direção invertida!';
      proximoJogador();
      await atualizarTurno();
      turno();
    } else if (carta.valor === 'Coringa') {
      if (jogadorAtual < humanos) {
        const corEscolhida = await escolherCorHumano();
        mesa.cor = corEscolhida;
        atualizarMesa();
      } else {
        const corEscolhida = escolherCorBot(maos[jogadorAtual]);
        mesa.cor = corEscolhida;
        infoDiv.textContent = `Bot escolheu a cor ${corEscolhida}`;
        atualizarMesa();
      }
      proximoJogador();
      await atualizarTurno();
      turno();
    } else {
      proximoJogador();
      await atualizarTurno();
      turno();
    }
  }

  async function turno() {
    await atualizarTurno();
    atualizarMao();
    if (jogadorAtual >= humanos) {
      await esperar(1500);
      jogarBot();
    } else {
      jogoEmAndamento = true;
    }
  }
  
  async function esperar(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  function escolherCorBot(maoBot) {
    const contagem = {};
    for (const c of maoBot) {
      if (c.cor !== 'Coringa') contagem[c.cor] = (contagem[c.cor] || 0) + 1;
    }
    let corEscolhida = 'Vermelho';
    let max = 0;
    for (const c in contagem) {
      if (contagem[c] > max) {
        max = contagem[c];
        corEscolhida = c;
      }
    }
    return corEscolhida;
  }

  async function jogarBot() {
    const mao = maos[jogadorAtual];
    const cartasJogaveis = mao.filter(carta => podeJogar(carta, mesa));
    let cartaParaJogar = null;

    if (punicao > 0) {
        cartaParaJogar = cartasJogaveis.find(c => c.valor === '+2' || c.valor === '+4');
    }

    if (!cartaParaJogar) {
        cartaParaJogar = cartasJogaveis.find(c => c.cor === mesa.cor && c.cor !== 'Coringa');
    }

    if (!cartaParaJogar) {
        cartaParaJogar = cartasJogaveis.find(c => c.valor === mesa.valor && c.cor !== 'Coringa');
    }

    if (!cartaParaJogar) {
        cartaParaJogar = cartasJogaveis.find(c => c.cor === 'Coringa');
    }
    
    if (cartaParaJogar) {
      const idx = mao.indexOf(cartaParaJogar);
      const cartaFicticia = document.createElement('div');
      cartaFicticia.className = `carta ${cartaParaJogar.cor}`;
      cartaFicticia.textContent = cartaParaJogar.valor;
      maoBotsDiv.appendChild(cartaFicticia);
      
      const rect = cartaFicticia.getBoundingClientRect();
      const mesaRect = mesaDiv.getBoundingClientRect();
      cartaFicticia.style.position = 'fixed';
      cartaFicticia.style.left = `${rect.left}px`;
      cartaFicticia.style.top = `${rect.top}px`;
      cartaFicticia.style.zIndex = '100';
      cartaFicticia.style.transition = 'all 0.5s ease-in-out';
      cartaFicticia.style.transform = `translate(${mesaRect.left - rect.left + mesaRect.width / 2}px, ${mesaRect.top - rect.top + mesaRect.height / 2}px) scale(1.2)`;
      
      await esperar(500);
      cartaFicticia.remove();

      maos[jogadorAtual].splice(idx, 1);
      const mesaAnterior = mesa;
      mesa = cartaParaJogar;
      
      infoDiv.textContent = `Bot Jogador ${jogadorAtual + 1} jogou ${mostrarCarta(cartaParaJogar)}`;
      atualizarMesa();
      atualizarMao();

      if (maos[jogadorAtual].length === 0) {
        alert(`Bot Jogador ${jogadorAtual + 1} venceu!`);
        resetarJogo();
        return;
      }
      await aplicarEfeitoCarta(cartaParaJogar, mesaAnterior);
    } else {
      infoDiv.textContent = `Bot Jogador ${jogadorAtual + 1} comprou ${punicao > 0 ? punicao : 1} cartas.`;
      await comprarCartas(punicao > 0 ? punicao : 1);
      punicao = 0;
      await esperar(1000);
      proximoJogador();
      turno();
    }
  }

  function resetarJogo() {
    startBtn.style.display = 'inline-block';
    configDiv.style.display = 'block';
    mesaDiv.style.display = 'none';
    maoDiv.innerHTML = '';
    maoBotsDiv.innerHTML = '';
    comprarBtn.style.display = 'none';
    unoBtn.style.display = 'none';
    alert('Fim de jogo. Recarregue a página para jogar novamente.');
  }

  comprarBtn.onclick = comprarBtnClick;
  unoBtn.onclick = () => {
      unoAnunciado = true;
      infoDiv.textContent = 'UNO! Anunciado. Agora jogue sua carta final.';
      unoBtn.style.display = 'none';
  };

  pegarUnoBtn.onclick = async () => {
    // Lógica para pegar o jogador que tem 1 carta e não gritou UNO!
    const jogadorAnterior = (jogadorAtual - direcao + numJogadores) % numJogadores;
    if (maos[jogadorAnterior].length === 1 && !unoAnunciado) {
      infoDiv.textContent = `Opa! Jogador ${jogadorAnterior + 1} não gritou UNO! Compra 2 cartas.`;
      maos[jogadorAnterior].push(baralho.pop());
      maos[jogadorAnterior].push(baralho.pop());
      atualizarMao();
    } else {
      infoDiv.textContent = `Você gritou "Pegar UNO!" mas o jogador estava ok. Você compra 2 cartas!`;
      maos[jogadorAtual].push(baralho.pop());
      maos[jogadorAtual].push(baralho.pop());
      atualizarMao();
    }
  };

  startBtn.onclick = async () => {
    humanos = parseInt(numHumanosSelect.value);
    bots = parseInt(numBotsSelect.value);
    numJogadores = humanos + bots;
    if (numJogadores < 2 || numJogadores > 8) {
      alert('O total de jogadores deve ser entre 2 e 8.');
      return;
    }

    configDiv.style.display = 'none';
    mesaDiv.style.display = 'block';

    baralho = criarBaralho();
    maos = Array.from({length: numJogadores}, () => []);

    for (let i = 0; i < 7; i++) {
      for (let j = 0; j < numJogadores; j++) {
        maos[j].push(baralho.pop());
      }
    }

    do {
      mesa = baralho.pop();
    } while (mesa.cor === 'Coringa' || mesa.valor === '+2' || mesa.valor === 'Pular' || mesa.valor === 'Inverter');

    atualizarMesa();
    jogadorAtual = 0;
    direcao = 1;
    punicao = 0;
    unoAnunciado = false;
    turno();
  };
})();
</script>

</body>
</html>