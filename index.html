<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>UNO com Bots</title>
<style>
  body { font-family: 'Segoe UI', Arial, sans-serif; background: #2c3e50; color: #ecf0f1; text-align: center; margin: 0; padding: 0; }
  h1 { margin-top: 25px; font-weight: 300; }
  #mesa {
    margin: 30px auto; padding: 20px; border: 4px solid #fff; max-width: 300px;
    font-size: 1.4em; border-radius: 15px; background: #34495e;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
  }
  #cartaMesa {
    margin-top: 15px; padding: 30px; border-radius: 18px;
    font-weight: bold; font-size: 1.6em; user-select: none;
    box-shadow: 0 0 20px 5px rgba(255,255,255,0.7);
    transition: all 0.3s ease;
  }
  #mao {
    margin: 25px auto; display: flex; justify-content: center; flex-wrap: wrap; gap: 15px; max-width: 950px;
  }
  .carta {
    padding: 25px 32px; border-radius: 18px; cursor: pointer;
    user-select: none; font-weight: bold; font-size: 1.4em;
    color: white;
    box-shadow: 0 5px 10px rgba(0,0,0,0.8);
    transition: transform 0.2s, box-shadow 0.2s;
    min-width: 75px; text-align: center;
    position: relative;
    user-select:none;
  }
  .carta:hover {
    transform: translateY(-8px) scale(1.1);
    box-shadow: 0 8px 18px rgba(255,255,255,0.8);
  }
  .Vermelho { background-color: #c0392b; }
  .Verde { background-color: #27ae60; }
  .Azul { background-color: #2980b9; }
  .Amarelo { background-color: #f39c12; color: black; }
  .Coringa {
    background: linear-gradient(45deg, #2c3e50, #555);
    color: white;
  }
  button {
    margin: 10px 15px; padding: 14px 35px; font-size: 1.2em;
    cursor: pointer; border-radius: 10px; border: none; background: #3498db; color: white;
    transition: background-color 0.3s, transform 0.2s;
    box-shadow: 0 4px 6px rgba(0,0,0,0.5);
  }
  button:hover {
    background: #2980b9;
    transform: translateY(-2px);
  }
  #info {
    margin-top: 20px; font-size: 1.2em; min-height: 40px;
  }
  #config {
    margin: 30px auto; max-width: 400px; background: #34495e; padding: 25px;
    border-radius: 15px; border: 2px solid #446;
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
  }
  label {
    display: block; margin: 12px 0 8px 0; font-weight: bold; font-size: 1.2em;
  }
  select, input[type=number] {
    width: 70px; padding: 8px; font-size: 1.1em; border-radius: 8px; border: 1px solid #777;
    background: #2c3e50; color: white; text-align: center;
  }
  #mao-bots {
    margin: 20px auto; display: flex; justify-content: center; gap: 10px;
  }
  .mao-bot {
    width: 60px; height: 80px; background: #7f8c8d; border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.1em;
    border: 2px solid #bdc3c7;
  }
</style>
</head>
<body>

<h1>UNO com Bots</h1>

<div id="config">
  <label for="numHumanos">Número de jogadores humanos:</label>
  <select id="numHumanos">
    <option value="1" selected>1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
  </select>

  <label for="numBots">Número de bots:</label>
  <select id="numBots">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3" selected>3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
  </select>

  <button id="startBtn">Começar Jogo</button>
  <div style="margin-top:10px; font-size: 0.9em; color: #aaa;">
    * Total de jogadores deve ser entre 2 e 8.
  </div>
</div>

<div id="mesa" style="display:none;">
  <div id="turno"></div>
  <div><strong>Carta na mesa:</strong></div>
  <div id="cartaMesa"></div>
  <div id="info"></div>
</div>

<div id="mao-bots"></div>

<div id="mao"></div>

<button id="comprarBtn" style="display:none;">Comprar Carta</button>
<button id="unoBtn" style="display:none;">UNO!</button>

<script>
(() => {
  const cores = ['Vermelho', 'Verde', 'Azul', 'Amarelo'];
  const numeros = Array.from({length: 10}, (_, i) => i);
  const acoes = ['Pular', 'Inverter', '+2'];
  const coringas = ['Coringa', '+4'];

  let baralho = [];
  let maos = [];
  let mesa = null;
  let jogadorAtual = 0;
  let direcao = 1;
  let numJogadores = 4;
  let humanos = 1;
  let bots = 3;
  let punicao = 0;
  let unoAnunciado = false;

  const cartaMesaDiv = document.getElementById('cartaMesa');
  const maoDiv = document.getElementById('mao');
  const turnoDiv = document.getElementById('turno');
  const infoDiv = document.getElementById('info');
  const comprarBtn = document.getElementById('comprarBtn');
  const unoBtn = document.getElementById('unoBtn');
  const startBtn = document.getElementById('startBtn');
  const numHumanosSelect = document.getElementById('numHumanos');
  const numBotsSelect = document.getElementById('numBots');
  const mesaDiv = document.getElementById('mesa');
  const configDiv = document.getElementById('config');
  const maoBotsDiv = document.getElementById('mao-bots');

  function criarBaralho() {
    let baralho = [];
    for (const cor of cores) {
      baralho.push({cor, valor: 0});
      for (let n = 1; n <= 9; n++) {
        baralho.push({cor, valor: n});
        baralho.push({cor, valor: n});
      }
      for (const acao of acoes) {
        baralho.push({cor, valor: acao});
        baralho.push({cor, valor: acao});
      }
    }
    for (let i = 0; i < 4; i++) {
      baralho.push({cor: 'Coringa', valor: 'Coringa'});
      baralho.push({cor: 'Coringa', valor: '+4'});
    }
    return baralho.sort(() => Math.random() - 0.5);
  }

  function mostrarCarta(carta) {
    if (!carta) return '';
    return carta.valor + (carta.cor !== 'Coringa' ? ' de ' + carta.cor : '');
  }

  function podeJogar(carta, mesa) {
    if (!mesa) return true;
    // Se há punição, só pode jogar carta de punição (+2 ou +4)
    if (punicao > 0) {
        return (carta.valor === '+2' || carta.valor === '+4');
    }
    return (
      carta.cor === mesa.cor ||
      carta.valor === mesa.valor ||
      carta.cor === 'Coringa'
    );
  }

  function atualizarMesa() {
    cartaMesaDiv.textContent = mostrarCarta(mesa);
    cartaMesaDiv.className = mesa.cor;
    if (punicao > 0) {
        infoDiv.textContent = `Punição acumulada: +${punicao} cartas!`;
    } else {
        infoDiv.textContent = '';
    }
  }

  function atualizarMao() {
    maoDiv.innerHTML = '';
    const mao = maos[jogadorAtual];
    const jogadorEhHumano = jogadorAtual < humanos;
    mao.forEach((carta, idx) => {
      const div = document.createElement('div');
      div.className = 'carta ' + carta.cor;
      div.textContent = carta.valor;
      div.title = mostrarCarta(carta);
      if (jogadorEhHumano && podeJogar(carta, mesa)) {
        div.onclick = () => jogarCarta(idx);
      } else {
        div.style.opacity = '0.5';
      }
      maoDiv.appendChild(div);
    });

    comprarBtn.style.display = jogadorEhHumano ? 'inline-block' : 'none';
    unoBtn.style.display = (jogadorEhHumano && mao.length === 2 && !unoAnunciado) ? 'inline-block' : 'none';

    // Atualiza as mãos dos bots
    maoBotsDiv.innerHTML = '';
    for (let i = humanos; i < numJogadores; i++) {
        const div = document.createElement('div');
        div.className = 'mao-bot';
        div.textContent = maos[i].length;
        maoBotsDiv.appendChild(div);
    }
  }

  function atualizarTurno() {
    const tipoJogador = jogadorAtual < humanos ? 'Humano' : 'Bot';
    turnoDiv.textContent = `Turno do Jogador ${jogadorAtual + 1} (${tipoJogador})`;
  }

  function proximoJogador() {
    jogadorAtual = (jogadorAtual + direcao + numJogadores) % numJogadores;
  }

  function escolherCor(callback) {
    infoDiv.innerHTML = 'Escolha uma cor: ';
    cores.forEach((cor) => {
      const btn = document.createElement('button');
      btn.textContent = cor;
      btn.style.backgroundColor = getCorCSS(cor);
      btn.style.color = (cor === 'Amarelo') ? 'black' : 'white';
      btn.style.margin = '0 5px';
      btn.onclick = () => {
        infoDiv.textContent = '';
        callback(cor);
      };
      infoDiv.appendChild(btn);
    });
  }

  function getCorCSS(cor) {
    switch(cor) {
        case 'Vermelho': return '#c0392b';
        case 'Verde': return '#27ae60';
        case 'Azul': return '#2980b9';
        case 'Amarelo': return '#f39c12';
        case 'Coringa': return '#555';
        default: return '#ccc';
    }
  }

  function comprarCartas(num) {
      for (let i = 0; i < num; i++) {
          if (baralho.length === 0) {
              alert('Baralho vazio! Embaralhando as cartas da mesa.');
              baralho = [mesa];
              mesa = null;
              baralho = baralho.sort(() => Math.random() - 0.5);
          }
          maos[jogadorAtual].push(baralho.pop());
      }
  }

  function comprarBtnClick() {
      if (punicao > 0) {
          comprarCartas(punicao);
          infoDiv.textContent = `Você comprou ${punicao} cartas!`;
          punicao = 0;
          proximoJogador();
          turno();
      } else {
          comprarCartas(1);
          const cartaComprada = maos[jogadorAtual][maos[jogadorAtual].length - 1];
          if (podeJogar(cartaComprada, mesa)) {
              infoDiv.textContent = `Você comprou: ${mostrarCarta(cartaComprada)}. Clique para jogar ou compre de novo para passar a vez.`;
              // O jogador tem a opção de jogar ou passar a vez
              comprarBtn.onclick = () => {
                  proximoJogador();
                  turno();
              };
          } else {
              proximoJogador();
              turno();
          }
      }
      atualizarMao();
  }

  function jogarCarta(idx) {
    const mao = maos[jogadorAtual];
    const carta = mao[idx];
    if (!podeJogar(carta, mesa)) {
      infoDiv.textContent = `Essa carta não pode ser jogada!`;
      return;
    }

    mao.splice(idx, 1);
    const mesaAnterior = mesa;
    mesa = carta;
    atualizarMesa();
    atualizarMao();

    if (mao.length === 1 && !unoAnunciado) {
        alert('Você não gritou UNO! Punição de 2 cartas.');
        comprarCartas(2);
        atualizarMao();
    } else if (mao.length === 0) {
      alert(`Jogador ${jogadorAtual + 1} venceu!`);
      resetarJogo();
      return;
    }
    
    unoAnunciado = false;

    aplicarEfeitoCarta(carta, mesaAnterior);
  }

  function aplicarEfeitoCarta(carta, mesaAnterior) {
    if (carta.valor === '+2') {
        punicao += 2;
        proximoJogador();
        atualizarTurno();
        turno();
    } else if (carta.valor === '+4') {
        punicao += 4;
        if (jogadorAtual < humanos) {
            escolherCor((cor) => {
                mesa.cor = cor;
                atualizarMesa();
                proximoJogador();
                atualizarTurno();
                turno();
            });
        } else {
            const corEscolhida = escolherCorBot(maos[jogadorAtual]);
            mesa.cor = corEscolhida;
            atualizarMesa();
            proximoJogador();
            atualizarTurno();
            turno();
        }
    } else if (punicao > 0) {
        comprarCartas(punicao);
        infoDiv.textContent = `Jogador ${(jogadorAtual + direcao + numJogadores) % numJogadores + 1} comprou ${punicao} cartas.`;
        punicao = 0;
        proximoJogador();
        atualizarTurno();
        turno();
    } else if (carta.valor === 'Pular') {
      infoDiv.textContent = `Jogador ${(jogadorAtual + direcao + numJogadores) % numJogadores + 1} foi pulado!`;
      proximoJogador();
      proximoJogador();
      atualizarTurno();
      turno();
    } else if (carta.valor === 'Inverter') {
      direcao *= -1;
      infoDiv.textContent = 'Direção invertida!';
      proximoJogador();
      atualizarTurno();
      turno();
    } else if (carta.valor === 'Coringa') {
      if (jogadorAtual < humanos) {
        escolherCor((cor) => {
          mesa.cor = cor;
          atualizarMesa();
          proximoJogador();
          atualizarTurno();
          turno();
        });
      } else {
        const corEscolhida = escolherCorBot(maos[jogadorAtual]);
        mesa.cor = corEscolhida;
        infoDiv.textContent = `Bot escolheu a cor ${corEscolhida}`;
        atualizarMesa();
        proximoJogador();
        atualizarTurno();
        turno();
      }
    } else {
      proximoJogador();
      atualizarTurno();
      turno();
    }
  }

  function turno() {
    atualizarTurno();
    atualizarMao();
    if (jogadorAtual >= humanos) {
      setTimeout(() => {
        jogarBot();
      }, 1500);
    }
  }

  function escolherCorBot(maoBot) {
    const contagem = {};
    for (const c of maoBot) {
      if (c.cor !== 'Coringa') contagem[c.cor] = (contagem[c.cor] || 0) + 1;
    }
    let corEscolhida = 'Vermelho';
    let max = 0;
    for (const c in contagem) {
      if (contagem[c] > max) {
        max = contagem[c];
        corEscolhida = c;
      }
    }
    return corEscolhida;
  }

  function jogarBot() {
    const mao = maos[jogadorAtual];
    const cartasJogaveis = mao.filter(carta => podeJogar(carta, mesa));

    // Lógica do bot
    let cartaParaJogar = null;

    // Prioridade 1: Jogar +2 ou +4 para empilhar se houver punição
    if (punicao > 0) {
        cartaParaJogar = cartasJogaveis.find(c => c.valor === '+2' || c.valor === '+4');
    }

    // Prioridade 2: Jogar carta de mesma cor, se possível
    if (!cartaParaJogar) {
        cartaParaJogar = cartasJogaveis.find(c => c.cor === mesa.cor && c.cor !== 'Coringa');
    }

    // Prioridade 3: Jogar carta de mesmo valor
    if (!cartaParaJogar) {
        cartaParaJogar = cartasJogaveis.find(c => c.valor === mesa.valor && c.cor !== 'Coringa');
    }

    // Prioridade 4: Jogar coringa
    if (!cartaParaJogar) {
        cartaParaJogar = cartasJogaveis.find(c => c.cor === 'Coringa');
    }
    
    if (cartaParaJogar) {
      const idx = mao.indexOf(cartaParaJogar);
      maos[jogadorAtual].splice(idx, 1);
      const mesaAnterior = mesa;
      mesa = cartaParaJogar;
      infoDiv.textContent = `Bot Jogador ${jogadorAtual + 1} jogou ${mostrarCarta(cartaParaJogar)}`;
      atualizarMesa();
      atualizarMao();

      if (maos[jogadorAtual].length === 0) {
        alert(`Bot Jogador ${jogadorAtual + 1} venceu!`);
        resetarJogo();
        return;
      }
      aplicarEfeitoCarta(cartaParaJogar, mesaAnterior);
    } else {
      // Bot compra e passa a vez
      comprarCartas(punicao > 0 ? punicao : 1);
      infoDiv.textContent = `Bot Jogador ${jogadorAtual + 1} comprou ${punicao > 0 ? punicao : 1} cartas.`;
      punicao = 0;
      proximoJogador();
      turno();
    }
  }

  function resetarJogo() {
    startBtn.style.display = 'inline-block';
    configDiv.style.display = 'block';
    mesaDiv.style.display = 'none';
    maoDiv.innerHTML = '';
    maoBotsDiv.innerHTML = '';
    comprarBtn.style.display = 'none';
    unoBtn.style.display = 'none';
    alert('Fim de jogo. Recarregue a página para jogar novamente.');
  }

  comprarBtn.onclick = comprarBtnClick;
  unoBtn.onclick = () => {
      unoAnunciado = true;
      infoDiv.textContent = 'UNO! Anunciado. Agora jogue sua carta final.';
      unoBtn.style.display = 'none';
  };

  startBtn.onclick = () => {
    humanos = parseInt(numHumanosSelect.value);
    bots = parseInt(numBotsSelect.value);
    numJogadores = humanos + bots;
    if (numJogadores < 2 || numJogadores > 8) {
      alert('O total de jogadores deve ser entre 2 e 8.');
      return;
    }

    configDiv.style.display = 'none';
    mesaDiv.style.display = 'block';

    baralho = criarBaralho();
    maos = Array.from({length: numJogadores}, () => []);

    for (let i = 0; i < 7; i++) {
      for (let j = 0; j < numJogadores; j++) {
        maos[j].push(baralho.pop());
      }
    }

    do {
      mesa = baralho.pop();
    } while (mesa.cor === 'Coringa' || mesa.valor === '+2' || mesa.valor === 'Pular' || mesa.valor === 'Inverter');

    atualizarMesa();
    jogadorAtual = 0;
    direcao = 1;
    punicao = 0;
    unoAnunciado = false;
    turno();
  };
})();
</script>

</body>
</html>